"use strict";(()=>{(()=>{"use strict";let a=document.currentScript,c=a?.getAttribute("data-site-key")??"",u=a?.getAttribute("data-api-url")??a?.src?.replace(/\/[^/]*$/,"")??"",k=a?.getAttribute("data-include-query")==="true";if(!c||!u)return;let d="",p=Date.now(),b=()=>k?window.location.pathname+window.location.search:window.location.pathname,v=()=>{let t=document.referrer;if(!t)return"";try{return new URL(t).hostname===window.location.hostname?"":t}catch{return t}},S=t=>{let n=new URLSearchParams(window.location.search),e={site_key:c,name:"",path:b(),properties:"",referrer:v(),screen_width:window.innerWidth,duration:0,utm_source:n.get("utm_source")||"",utm_medium:n.get("utm_medium")||"",utm_campaign:n.get("utm_campaign")||""};if(!t)return e;let{name:i,path:o,referrer:g,screen_width:f,duration:y,properties:s,utm_source:h,utm_medium:w,utm_campaign:_}=t??{};return typeof i=="string"&&(e.name=i),typeof o=="string"&&(e.path=o),typeof g=="string"&&(e.referrer=g),typeof f=="number"&&(e.screen_width=f),typeof y=="number"&&(e.duration=y),typeof h=="string"&&(e.utm_source=h),typeof w=="string"&&(e.utm_medium=w),typeof _=="string"&&(e.utm_campaign=_),typeof s=="string"?e.properties=s:s&&(e.properties=JSON.stringify(s)),e},T=(t,n)=>{let e=`${u}${t}?site_key=${encodeURIComponent(c)}`,i=JSON.stringify(n);if(navigator.sendBeacon){let o=new Blob([i],{type:"application/json"});navigator.sendBeacon(e,o)}else fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:i,keepalive:!0}).catch(()=>{})},r=t=>{let n=S(t);n.path===d&&!n.name&&n.duration===0||(d=n.path,T("/api/collect",n),p=Date.now())},m=()=>{let t=Math.round((Date.now()-p)/1e3);t>0&&t<3600&&r({duration:t})},l=()=>{r(),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"&&m()});let t=history.pushState;history.pushState=function(){t.apply(this,arguments),r()};let n=history.replaceState;history.replaceState=function(){n.apply(this,arguments),r()},window.addEventListener("popstate",r),window.addEventListener("beforeunload",m)};window.lovelyEye={track:r},document.readyState==="complete"?l():window.addEventListener("load",l)})();})();
